{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\nexports.str = str;\nexports.html = html;\nexports.group = group;\nexports.initI18n = initI18n;\nvar _react = require('react');\nvar _react2 = _interopRequireDefault(_react);\nvar _immutable = require('immutable');\nvar _immutable2 = _interopRequireDefault(_immutable);\nvar _format = require('./utils/format');\nvar _format2 = _interopRequireDefault(_format);\nvar _dompurify = require('dompurify');\nvar _sync = require('./sync');\nvar _sync2 = _interopRequireDefault(_sync);\nvar _index = require('./core/index');\nvar l = _interopRequireWildcard(_index);\nvar _data_utils = require('./utils/data_utils');\nvar _en = require('./i18n/en');\nvar _en2 = _interopRequireDefault(_en);\nvar _cdn_utils = require('./utils/cdn_utils');\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n    newObj.default = obj;\n    return newObj;\n  }\n}\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nvar _dataFns = (0, _data_utils.dataFns)(['i18n']),\n  get = _dataFns.get,\n  set = _dataFns.set;\nfunction str(m, keyPath) {\n  for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    args[_key - 2] = arguments[_key];\n  }\n  return _format2.default.apply(undefined, [get(m, ['strings'].concat(keyPath), '')].concat(args));\n}\nfunction html(m, keyPath) {\n  for (var _len2 = arguments.length, args = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n    args[_key2 - 2] = arguments[_key2];\n  }\n  var html = str.apply(undefined, [m, keyPath].concat(args));\n  // dangerouslySetInnerHTML input is sanitized using dompurify\n  // eslint-disable-next-line react/no-danger\n  return html ? _react2.default.createElement('span', {\n    dangerouslySetInnerHTML: {\n      __html: (0, _dompurify.sanitize)(html)\n    }\n  }) : null;\n}\nfunction group(m, keyPath) {\n  return get(m, ['strings'].concat(keyPath), (0, _immutable.Map)()).toJS();\n}\nfunction initI18n(m) {\n  var language = l.ui.language(m);\n  var overrides = l.ui.dict(m);\n  var defaultDictionary = _immutable2.default.fromJS(_en2.default);\n  var base = languageDictionaries[language] || (0, _immutable.Map)({});\n  if (base.isEmpty()) {\n    base = overrides;\n    m = (0, _sync2.default)(m, 'i18n', {\n      syncFn: function syncFn(_, cb) {\n        return syncLang(m, language, cb);\n      },\n      successFn: function successFn(m, result) {\n        registerLanguageDictionary(language, result);\n        var overrided = _immutable2.default.fromJS(result).mergeDeep(overrides);\n        assertLanguage(m, overrided.toJS(), _en2.default);\n        return set(m, 'strings', defaultDictionary.mergeDeep(overrided));\n      },\n      recoverResult: m,\n      errorFn: function errorFn(m, error) {\n        l.warn(m, error.message + ' Falling back to default dictionary.');\n      }\n    });\n  } else {\n    assertLanguage(m, base.toJS(), _en2.default);\n  }\n  base = defaultDictionary.mergeDeep(base).mergeDeep(overrides);\n  return set(m, 'strings', base);\n}\nfunction assertLanguage(m, language, base) {\n  var path = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n  Object.keys(base).forEach(function (key) {\n    if (!language.hasOwnProperty(key)) {\n      l.warn(m, 'language does not have property ' + path + key);\n    } else {\n      if (_typeof(base[key]) === 'object') {\n        assertLanguage(m, language[key], base[key], '' + path + key + '.');\n      }\n    }\n  });\n}\n\n// sync\n\nfunction syncLang(m, language, _cb) {\n  (0, _cdn_utils.load)({\n    method: 'registerLanguageDictionary',\n    url: l.languageBaseUrl(m) + '/js/lock/' + '11.35.1' + '/' + language + '.js',\n    check: function check(str) {\n      return str && str === language;\n    },\n    cb: function cb(err, _, dictionary) {\n      _cb(err, dictionary);\n    }\n  });\n}\nvar languageDictionaries = [];\nfunction registerLanguageDictionary(language, dictionary) {\n  languageDictionaries[language] = _immutable2.default.fromJS(dictionary);\n}\nif (typeof window !== 'undefined') {\n  (0, _cdn_utils.preload)({\n    method: 'registerLanguageDictionary',\n    cb: registerLanguageDictionary\n  });\n}","map":null,"metadata":{},"sourceType":"script"}